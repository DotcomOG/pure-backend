<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SnipeRank SEO Summary Report</title>
  <link href="https://fonts.googleapis.com/css2?family=Forum&family=Nunito+Sans:wght@300;400;700&display=swap" rel="stylesheet">


<!-- Lottie Player -->
<script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>


  <style>
    body { font-family: 'Nunito Sans', sans-serif; background: #f9f9f9; margin: 0; padding: 0; }
    header { text-align: center; padding: 15px; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .container { max-width: 700px; margin: 30px auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    h1, h2 { font-family: 'Forum', serif; color: #333; text-align:center; }

    .score-container { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px; }
    .info-icon { cursor: pointer; font-weight: bold; background: #007BFF; color: #fff; padding: 3px 8px; border-radius: 50%; font-size: 12px; }
    .score-indicator { width: 50%; height: 20px; background: linear-gradient(to right, red, yellow, green); position: relative; border-radius: 10px; overflow: hidden; }
    .score-marker { width: 2px; height: 100%; position: absolute; background: #000; animation: bounce 2s infinite ease-in-out; }
    .score-percentage { position: absolute; width: 100%; text-align: center; line-height: 20px; font-size: 0.9em; color: #000; pointer-events: none; }

    @keyframes bounce { 0%, 100% { left: 0%; } 50% { left: 100%; } }

    ul { padding:0; }
    li { margin-bottom:10px; list-style:none; }
    .title { font-weight:bold; }
    .explanation { font-size:0.9em; color:#555; }

    .form-container { width:75%; margin:auto; text-align:center; }
    .form-row { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-bottom:10px; }
    input { padding:8px; flex:1; min-width:150px; }
    button { padding:10px 20px; cursor:pointer; }

    #url-lightbox { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 10000; }
    .lightbox-content { background: white; padding: 25px; border-radius: 10px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    .lightbox-content input, .lightbox-content button { width: 90%; max-width: 400px; margin: 10px 0; padding: 12px; font-size: 16px; }
    .lightbox-content button { cursor: pointer; background: #007BFF; color: white; border: none; border-radius: 5px; transition: background 0.3s; }
    .lightbox-content button:hover { background: #0056b3; }

    #lightbox { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:20000; }
    #lightbox-content { background:#fff; max-width:400px; margin:100px auto; padding:20px; border-radius:8px; position:relative; }
    #lightbox-close { position:absolute; top:10px; right:10px; cursor:pointer; font-weight:bold; }

/* Responsive adjustments for Score Explained Lightbox */
@media (max-width: 768px) {
  #score-lightbox .lightbox-content {
    width: 80% !important;
  }
}

  </style>
</head>
<body>

<div id="url-lightbox">
  <div class="lightbox-content">
    <input type="text" id="urlInput" placeholder="Enter website URL" required>
    <button id="analyzeButton">Analyze</button>
  </div>
</div>

<header><h2>Yoram Ezra Strategies</h2></header>

<div class="container">
  <h1>SnipeRank AI-SEO Analyzer<br>Summary Report</h1>
  <p>URL inspected: <strong id="inspected-url">Waiting for URL...</strong></p>
 
<div id="waiting-message" style="text-align: center;">
  <p>Weâ€™re scanning and analyzing the site.<br>It may take up to a minute.</p>
  <lottie-player
    src="https://lottie.host/dff3f4a5-0fbd-4226-b568-16f1fb1283ee/p6gwsnbzXB.lottie"
    background="transparent"
    speed="1"
    style="width: 100px; height: 100px; margin: 10px auto;"
    loop autoplay>
  </lottie-player>
</div>

  <div class="score-container">
    <span class="info-icon" onclick="document.getElementById('lightbox').style.display='block';">?</span>
    <div>AI SEO Score:</div>
    <div class="score-indicator">
      <div id="score-marker" class="score-marker"></div>
      <span class="score-percentage" id="score-percentage">Loading...</span>
    </div>
  </div>

  <h2>Superpowers</h2>
<ul id="superpowers-list"></ul> 
<h2>Opportunities</h2>
<ul id="opportunities-list"></ul>
  <h2>AI Insights</h2>
<ul id="engine-insights-list"></ul>

  <div class="form-container">
    <form id="summaryForm">
      <input type="hidden" id="hidden-url" value="">
      <div class="form-row">
        <input type="text" name="name" placeholder="Your Name*" required>
        <input type="email" name="email" placeholder="Your Email*" required>
      </div>
      <div class="form-row">
        <input type="text" name="company" placeholder="Company (optional)">
      </div>
      <button type="submit">Get Full Report</button>
    </form>
  </div>
</div>

<!-- Scoring Explanation Lightbox -->
<div id="score-lightbox" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:10000;">
  <div class="lightbox-content" style="position:relative; width:50%; max-width:600px;">
    <span id="score-lightbox-close" style="cursor:pointer; position:absolute; top:10px; right:15px; font-weight:bold; font-size:20px;">&times;</span>
    <h2>AI SEO Score Explained</h2>
    <p>This score evaluates key SEO factors specifically influencing your site's visibility in AI-driven search engines. Higher scores indicate better AI-specific SEO performance.</p>
    <ul style="text-align:left;">
      <li><strong>0-20:</strong> Critical AI SEO issues.</li>
      <li><strong>21-40:</strong> Severe AI SEO issues.</li>
      <li><strong>41-60:</strong> Moderate AI SEO issues.</li>
      <li><strong>61-80:</strong> Minor AI SEO issues.</li>
      <li><strong>81-100:</strong> Excellent AI SEO health.</li>
    </ul>
  </div>
</div>

// Paste the updated JavaScript provided here, as-is, to resolve animation and form issues.//

<script>

// Open score explanation lightbox
document.querySelector('.info-icon').onclick = () => {
  document.getElementById('score-lightbox').style.display = 'flex';
};

// Close the score explanation lightbox
document.getElementById('score-lightbox-close').onclick = () => {
  document.getElementById('score-lightbox').style.display = 'none';
};


document.addEventListener("DOMContentLoaded", () => {
  
  // Function to validate and redirect after URL submission from the lightbox
  const analyzeURL = () => {
    let url = document.getElementById('urlInput').value.trim();
    const regex = /^(https?:\/\/)?(www\.)?[a-zA-Z0-9-]+\.(com|org|net)(\/)?$/;
    
    if(regex.test(url)){
      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        url = 'https://' + url;
      }
      window.location.href = `/index.html?url=${encodeURIComponent(url)}`;
    } else {
      alert('Please enter a valid URL (e.g., www.example.com, example.com, https://example.com)');
    }
  };

  // Event listeners for button click and 'Enter' key press
  document.getElementById('analyzeButton').onclick = analyzeURL;
  document.getElementById('urlInput').onkeydown = e => { 
    if(e.key === 'Enter') analyzeURL(); 
  };

  // Get URL parameter if present
  const urlParam = new URLSearchParams(window.location.search).get("url");

  if (urlParam) {
    // Hide the URL input lightbox
    document.getElementById('url-lightbox').style.display = 'none';
    // Show URL being inspected
    document.getElementById('inspected-url').textContent = urlParam;

    // Fetch SEO data from backend
    fetch(`/friendly?url=${encodeURIComponent(urlParam)}`)
      .then(res => res.json())
      .then(data => {
        if (data.status === "processing") {
          setTimeout(() => window.location.reload(), 3000);
          return;
        }

        // Stop the score-marker animation and set its final position
        const marker = document.getElementById("score-marker");
        marker.style.animation = 'none';
        marker.style.left = data.score + '%';

        document.getElementById("score-percentage").textContent = data.score + "%";
        document.getElementById("waiting-message").style.display = 'none';

        // Helper function to render lists clearly
        const renderList = (id, items, emoji) => {
          document.getElementById(id).innerHTML = items.map(i => `
            <li>
              <div class="title">${emoji} ${i.title}</div>
              <div class="explanation">${i.explanation}</div>
            </li>
          `).join('');
        };

        renderList("superpowers-list", data.ai_superpowers, "âœ…");
        renderList("opportunities-list", data.ai_opportunities, "ðŸš¨");
        renderList("engine-insights-list", Object.entries(data.ai_engine_insights).map(([t,e])=>({title:t, explanation:e})), "ðŸ¤–");
      })
      .catch(err => {
        console.error("Error fetching data:", err);
        document.getElementById("waiting-message").textContent = "An error occurred. Please try again.";
      });
  }

  // Correctly handle the "Get Full Report" form submission
  document.getElementById('summaryForm').addEventListener('submit', e => {
    e.preventDefault();
    localStorage.setItem("userName", e.target.name.value);
    localStorage.setItem("userEmail", e.target.email.value);
    localStorage.setItem("userCompany", e.target.company.value);
    window.location = `/full-report.html?url=${encodeURIComponent(urlParam)}`;
  });

  // Fix (?) info icon to open the correct score explanation lightbox
  document.querySelector('.info-icon').onclick = () => {
    document.getElementById('score-lightbox').style.display = 'flex';
  };

  // Close the score explanation lightbox when clicking the close button
  document.getElementById('score-lightbox-close').onclick = () => {
    document.getElementById('score-lightbox').style.display = 'none';
  };
});
</script>

</body>
</html>