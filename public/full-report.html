<!-- Last updated: 2025-04-22 14:50 ET -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SnipeRank AI-SEO Detailed Report</title>
  <link href="https://fonts.googleapis.com/css2?family=Forum&family=Nunito+Sans:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Nunito Sans',sans-serif; background:#f9f9f9; margin:0; padding:0 }
    header { text-align:center; padding:15px; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.1) }
    .container { max-width:700px; margin:30px auto; background:#fff; padding:20px; border-radius:8px }
    h1,h2 { font-family:'Forum',serif; color:#333; text-align:center }
    ul { padding:0; list-style:none; margin:0 }
    li { margin:8px 0 }
    .title { font-weight:bold }
    .explanation { font-size:0.9em; color:#555 }
    .form-container { width:80%; max-width:400px; margin:24px auto; text-align:center }
    .form-container input, .form-container button { width:100%; padding:8px; margin:6px 0; font-size:1em }
    .form-container button { background:#007BFF; color:#fff; border:none; cursor:pointer }
    .error-message { color:red; text-align:center; margin:10px 0 }
  </style>
</head>
<body>

  <!-- Header -->
  <header><h2>Yoram Ezra Strategies</h2></header>

  <!-- Container -->
  <div class="container">
    <h1>Detailed AI-SEO Report</h1>
    <p>URL: <strong id="report-url">Loadingâ€¦</strong></p>
    <p>Score: <strong id="report-score">Loadingâ€¦</strong></p>
    <p class="error-message" id="errorReport"></p>

    <h2>Whatâ€™s Working (10â€“15)</h2>
    <ul id="full-superpowers"></ul>

    <h2>Needs Improvement (15â€“25)</h2>
    <ul id="full-opportunities"></ul>

    <h2>AI Engine Insights ðŸ’¡</h2>
    <ul id="full-insights"></ul>

    <div class="form-container">
      <form id="fullReportForm">
        <input type="text" id="fullName" placeholder="Your Name*" required>
        <input type="email" id="fullEmail" placeholder="Your Email*" required>
        <input type="text" id="fullCompany" placeholder="Company / Org (optional)">
        <button type="submit">Submit Report Request</button>
      </form>
    </div>
  </div>

  <script>
    const BACKEND_URL = 'https://ai-seo-backend-final.onrender.com/';

    document.addEventListener('DOMContentLoaded', async () => {
      const params = new URLSearchParams(window.location.search);
      const url = params.get('url');
      document.getElementById('report-url').textContent = url;

      document.getElementById('fullName').value    = localStorage.getItem('userName')    || '';
      document.getElementById('fullEmail').value   = localStorage.getItem('userEmail')   || '';
      document.getElementById('fullCompany').value = localStorage.getItem('userCompany') || '';

      try {
        const endpoint = `${BACKEND_URL}friendly?type=full&url=${encodeURIComponent(url)}`;
        const res = await fetch(endpoint, { mode:'cors', redirect:'follow' });
        if (!res.ok) {
          const err = await res.json();
          throw new Error(err.detail || `Server ${res.status}`);
        }
        const data = await res.json();

        document.getElementById('report-score').textContent = data.score + '%';
        const render = (id, items, emoji) => {
          document.getElementById(id).innerHTML = items.map(i =>
            `<li><div class="title">${emoji} ${i.title}</div><div class="explanation">${i.explanation}</div></li>`
          ).join('');
        };
        render('full-superpowers',   data.ai_superpowers,   'âœ…');
        render('full-opportunities', data.ai_opportunities,'ðŸš¨');
        render('full-insights',
               Object.entries(data.ai_engine_insights).map(([e,t])=>({title:e,explanation:t})),
               'ðŸ¤–');
        localStorage.setItem('fullData', JSON.stringify(data));
      } catch (err) {
        document.getElementById('errorReport').textContent = `Error loading report: ${err.message}`;
        console.error(err);
      }

      document.getElementById('fullReportForm').addEventListener('submit', async e => {
        e.preventDefault();
        const name    = document.getElementById('fullName').value.trim();
        const email   = document.getElementById('fullEmail').value.trim();
        const company = document.getElementById('fullCompany').value.trim();
        const data    = JSON.parse(localStorage.getItem('fullData')||'{}');

        await firebase.firestore().collection('reports').add({
          name, email, company, url, fullReport: data,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        document.getElementById('errorReport').style.color = 'green';
        document.getElementById('errorReport').textContent = 'âœ… Saved!';
      });
    });
  </script>
</body>
</html>