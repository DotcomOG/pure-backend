<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SnipeRank Detailed SEO Report</title>
  <link href="https://fonts.googleapis.com/css2?family=Forum&family=Nunito+Sans:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Nunito Sans', sans-serif; background: #f9f9f9; margin: 0; padding: 0; }
    header { text-align: center; padding: 15px; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    header h2 { font-family: 'Forum', serif; margin: 5px 0; }
    nav a { margin: 0 10px; text-decoration: none; font-weight: 600; color: #000; }
    .container { max-width: 700px; margin: 30px auto; background: #fff; padding: 20px 30px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    h1, h2 { font-family: 'Forum', serif; color: #333; }
    ul { padding-left:0; }
    li { margin-bottom:10px; }
    .title { font-weight:bold; }
    .explanation { font-size:0.9em; color:#666; }
  </style>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js';
    import { getFirestore, collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyBDSiVrtYRrDWTFCrbsZh1ud9ih_VJ1wgI",
      authDomain: "ai-seo-analyser.firebaseapp.com",
      projectId: "ai-seo-analyser",
      storageBucket: "ai-seo-analyser.firebasestorage.app",
      messagingSenderId: "137290326304",
      appId: "1:137290326304:web:cd50abaa0c0775e78eb745",
      measurementId: "G-Z1EP67F84G"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.submitContactForm = async (userData, reportData) => {
      try {
        await addDoc(collection(db, "reports"), {
          user: userData,
          report: reportData,
          timestamp: serverTimestamp()
        });
        alert('Your report has been successfully saved! I will reach out shortly.');
      } catch (e) {
        console.error("Error saving report:", e);
        alert('There was a problem saving your report. Please try again.');
      }
    };
  </script>
</head>
<body>
<header>
  <h2>Yoram Ezra Strategies</h2>
  <nav>
    <a href="https://www.yoramezra.com/">Home</a>
    AI SEO Analyzer
  </nav>
</header>

<div class="container">
  <h1 style="text-align:center;">
    SnipeRank Detailed AI SEO Analysis<br>
    <small style="font-size:0.7em;">ðŸ¤– Powered by ChatGPT ðŸ¤–</small>
  </h1>
  <p style="text-align:center;">URL inspected: <strong id="inspected-url">Analyzing...</strong></p>

  <div id="full-report-content">
    <h2>Site Superpowers (SEO Strengths)</h2>
    <ul id="superpowers-list"><li>SnipeRank is scanning and analying the site.<br>Loading...</li></ul>

    <h2>SEO Opportunities (Improvements Needed)</h2>
    <ul id="opportunities-list"><li>Loading...</li></ul>

    <h2>Detailed AI Engine Insights</h2>
    <ul id="engine-insights-list"><li>Loading...</li></ul>
  </div>

  <!-- Contact Me Form -->
  
<!-- Updated Contact Form at the bottom of your full-report.html -->
<div class="form-container" style="width:80%; margin:30px auto; background:#f0f8ff; padding:15px; border-radius:8px;">
  <h3 style="text-align:center;">Let's Talk About Your Report</h3>
  <form id="contactForm">
    <input type="hidden" id="hidden-url" value="">

    <!-- Name and Email -->
    <div class="form-row">
      <input type="text" name="name" placeholder="Your Name*" required>
      <input type="email" name="email" placeholder="Your Email*" required>
    </div>

    <!-- Company and Position -->
    <div class="form-row">
      <input type="text" name="company" placeholder="Company/Organization">
      <input type="text" name="position" placeholder="Position or Role">
    </div>

    <!-- Phone and Best Time to Contact -->
    <div class="form-row">
      <input type="tel" name="phone" placeholder="Phone Number">
      <select name="bestTime">
        <option value="">Best Time to Contact</option>
        <option>Morning</option>
        <option>Afternoon</option>
        <option>Evening</option>
      </select>
    </div>

    <!-- Website URL (auto-filled and readonly) -->
    <div class="form-row">
      <input type="text" name="websiteURL" id="websiteURL" value="" readonly>
    </div>

    <!-- Submit Button -->
    <button type="submit">Submit & Schedule Call</button>
  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const url = params.get("url") || "https://example.com";
  document.getElementById("websiteURL").value = url;

  document.getElementById('contactForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const userData = {
      name: e.target.name.value,
      email: e.target.email.value,
      company: e.target.company.value,
      position: e.target.position.value,
      phone: e.target.phone.value,
      bestTime: e.target.bestTime.value,
      websiteURL: url
    };

    const reportData = { url };

    try {
      await submitContactForm(userData, reportData);
      e.target.reset();
      alert('Your details have been successfully submitted.');
    } catch (err) {
      console.error('Submission failed:', err);
      alert('There was an error submitting your form. Please try again.');
    }
  });
});
</script>


<script>
document.addEventListener("DOMContentLoaded", function () {
  const url = new URLSearchParams(window.location.search).get("url") || "https://example.com";
  document.getElementById("inspected-url").textContent = url;

  const fetchReport = () => {
    fetch(`/friendly?url=${encodeURIComponent(url)}&detail=full`)
      .then(res => res.status === 202 ? (setTimeout(fetchReport,3000), null) : res.json())
      .then(data => {
        if (!data) return;
        const renderList = (id, items, emoji) => {
          document.getElementById(id).innerHTML = items.map(i => `
            <li><div class="title">${emoji} ${i.title}</div><div class="explanation">${i.explanation}</div></li>
          `).join('');
        };
        renderList("superpowers-list", data.ai_superpowers, "âœ…");
        renderList("opportunities-list", data.ai_opportunities, "ðŸš¨");
        renderList("engine-insights-list", Object.entries(data.ai_engine_insights).map(([title, explanation]) => ({ title, explanation })), "ðŸ¤–");
      }).catch(console.error);
  };

  fetchReport();

  document.getElementById('submitReportBtn').onclick = async () => {
    const userData = {
      name: document.getElementById('userName').value.trim(),
      email: document.getElementById('userEmail').value.trim(),
      company: document.getElementById('userCompany').value.trim() || 'Not Provided'
    };

    if (!userData.name || !userData.email) {
      alert('Please fill out your name and email.');
      return;
    }

    const reportData = {
      url: url,
      content: document.getElementById('full-report-content').innerHTML
    };

    await window.submitContactForm(userData, reportData);
  };
});
</script>
</body>
</html>
